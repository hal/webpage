
var fs = require("fs");

hexo.extend.helper.register('sidebar', function(locals){

    var path = locals.full_source;
    var dir = path.substring(0, path.lastIndexOf("/"));
    var context = locals.path.substring(0, locals.path.lastIndexOf("/"));
    var names = fs.readdirSync(dir);

    var buffer = "<div class='well sidebar-nav'><ul class='nav nav-list'>";

    buffer+= ("<li class='nav-header'>"+toTitleCase(context)+"</li>");

    for (var i=0;i<names.length;i++)
    {
        var name = names[i];

        // exclude system files
        if(name.indexOf("index")!=-1 || name.substring(0,1)=="_") continue;

        var fileName = name.replace(".md", ".html");
        var link = "/"+context + "/" + fileName;

        // create Link name

        var idx = fileName.indexOf("_");
        var title = idx>0 ? fileName.substr(idx, fileName.indexOf(".")) : fileName.substr(0, fileName.indexOf("."));
        var title = title.replace(/-/g, " ");
        var title = title.replace(/_/g, " ");

        buffer+= ("<li><a href='"+link+"'>"+toTitleCase(title)+"</a></li>");
    }
    buffer += "</ul></div>";
    return buffer;
});


function toTitleCase(str)
{
    return str.replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});
}